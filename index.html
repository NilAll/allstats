<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AllStats - Auditoria de Gols</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0d0f12; color: #ffffff; font-family: sans-serif; -webkit-tap-highlight-color: transparent; }
        .match-card { background: #1a1d23; border-radius: 16px; border: 1px solid #2d3139; margin-bottom: 12px; }
        .is-green { background-color: #22c55e !important; color: #000 !important; font-weight: 900; }
        .is-red { background-color: #ef4444 !important; color: #fff !important; font-weight: 900; }
        .not-green { background-color: #ffffff !important; color: #000 !important; font-weight: 900; }
        .live-pulse { width: 8px; height: 8px; background-color: #ef4444; border-radius: 50%; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
    </style>
</head>
<body class="pb-10">

    <header class="sticky top-0 bg-[#0d0f12]/95 backdrop-blur-md z-50 p-4 border-b border-gray-800 flex justify-between items-center">
        <h1 class="text-xl font-black italic uppercase">ALL<span class="text-green-500">STATS</span></h1>
        <button onclick="fetchData()" class="text-[10px] bg-gray-800 px-4 py-2 rounded-full font-bold uppercase">Atualizar</button>
    </header>

    <main class="p-4">
        <div id="stats-summary" class="flex gap-2 mb-6 hidden">
            <div class="flex-1 bg-green-600/20 border border-green-600 p-3 rounded-xl text-center">
                <div class="text-[10px] uppercase font-bold text-green-500">Greens (Hoje)</div>
                <div id="green-count" class="text-xl font-black">0</div>
            </div>
            <div class="flex-1 bg-red-600/20 border border-red-600 p-3 rounded-xl text-center">
                <div class="text-[10px] uppercase font-bold text-red-500">Reds (Hoje)</div>
                <div id="red-count" class="text-xl font-black">0</div>
            </div>
        </div>

        <div id="live-area"></div>
        <div id="finished-area"></div>
        <div id="next-area"></div>
        <div id="status" class="text-center py-20 text-gray-600 font-bold text-xs uppercase italic tracking-widest">Verificando Palpites...</div>
    </main>

    <script>
        const API_KEY = 'b12ef8888e5148479abd9c6632c8e00b';
        const PROXY = 'https://cors-anywhere.herokuapp.com/';

        async function fetchData() {
            try {
                // Busca hist√≥rico recente para auditoria e pr√≥ximos dias para agenda
                const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
                const start = yesterday.toISOString().split('T')[0];
                const end = new Date(); end.setDate(end.getDate() + 5);
                const dateTo = end.toISOString().split('T')[0];

                const res = await fetch(`${PROXY}https://api.football-data.org/v4/matches?dateFrom=${start}&dateTo=${dateTo}`, {
                    headers: { 'X-Auth-Token': API_KEY }
                });

                if (res.status === 403) {
                    document.getElementById('status').innerHTML = `<a href="${PROXY}corsdemo" target="_blank" class="bg-blue-600 p-3 rounded-lg text-white inline-block text-xs uppercase font-bold">Autorizar Proxy</a>`;
                    return;
                }
                const data = await res.json();
                document.getElementById('status').classList.add('hidden');
                
                const live = data.matches.filter(m => m.status === 'IN_PLAY' || m.status === 'PAUSED');
                const finished = data.matches.filter(m => m.status === 'FINISHED');
                const upcoming = data.matches.filter(m => m.status === 'TIMED' || m.status === 'SCHEDULED');

                renderSection('live-area', live, 'Ao Vivo', true, false);
                renderSection('finished-area', finished, 'Finalizados / Auditados', false, true);
                renderSection('next-area', upcoming, 'Pr√≥ximos Jogos', false, false);

                updateCounters(finished);
            } catch (e) { document.getElementById('status').innerText = "Erro ao carregar dados."; }
        }

        function analyze(match) {
            // L√≥gica fixa baseada no ID dos times
            const seed = match.homeTeam.id + match.awayTeam.id;
            const power = seed % 100;
            let mkt = power > 75 ? '+3.5 Gols' : power > 45 ? '+2.5 Gols' : power > 15 ? '+1.5 Gols' : '+0.5 Gols';
            // Palpite de Under para jogos muito "travados"
            if (power < 8) mkt = '- 2.5 Gols';
            return { mkt, prob: 70 + (seed % 20) };
        }

        function calculateWin(stat, h, a, isFinished) {
            const total = h + a;
            const target = parseFloat(stat.mkt.match(/[\d\.]+/)[0]);
            
            if (stat.mkt.includes('-')) {
                // CORRE√á√ÉO: Under s√≥ √© Green se o jogo j√° terminou e n√£o ultrapassou
                return isFinished && total < target;
            } else {
                // Over √© Green assim que bate a meta
                return total >= target;
            }
        }

        function updateCounters(finished) {
            let greens = 0, reds = 0;
            finished.forEach(match => {
                const stat = analyze(match);
                const win = calculateWin(stat, match.score.fullTime.home || 0, match.score.fullTime.away || 0, true);
                win ? greens++ : reds++;
            });
            document.getElementById('green-count').innerText = greens;
            document.getElementById('red-count').innerText = reds;
            document.getElementById('stats-summary').classList.remove('hidden');
        }

        function renderSection(id, list, title, isLive, isFinished) {
            const container = document.getElementById(id);
            if (!list.length) { container.innerHTML = ''; return; }

            container.innerHTML = `<h2 class="text-[10px] font-black text-gray-500 uppercase mb-3 mt-6 flex items-center gap-2">
                ${isLive ? '<span class="live-pulse"></span>' : ''}${title} (${list.length})</h2>` + 
            list.map(match => {
                const stat = analyze(match);
                const h = match.score.fullTime.home || 0;
                const a = match.score.fullTime.away || 0;
                
                // Usamos a nova fun√ß√£o corrigida de c√°lculo de vit√≥ria
                const win = calculateWin(stat, h, a, isFinished);
                
                // Status visual
                let statusClass = 'not-green'; // Padr√£o: Branco (Aguardando)
                let statusText = 'Aguardando';

                if (isFinished) {
                    statusClass = win ? 'is-green' : 'is-red';
                    statusText = win ? 'üéØ Green' : '‚ùå Red';
                } else if (win) {
                    // Se n√£o acabou mas j√° bateu a meta (ex: Over 0.5 e est√° 1x0)
                    statusClass = 'is-green';
                    statusText = 'üéØ Bateu';
                }

                const dt = new Date(match.utcDate);
                const timeStr = dt.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
                const dateStr = dt.toLocaleDateString([], {day:'2-digit', month:'2-digit'});

                return `
                <div class="match-card p-4">
                    <div class="flex justify-between text-[9px] mb-4 font-black text-gray-500 uppercase">
                        <span>${match.area.name} - ${match.competition.name}</span>
                        <span>${isFinished ? 'FIM' : (isLive ? 'LIVE' : dateStr + ' ' + timeStr)}</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <div class="flex-1 space-y-4">
                            <div class="flex items-center gap-3">
                                <img src="${match.homeTeam.crest}" class="w-6 h-6 object-contain">
                                <span class="text-sm font-bold text-gray-100">${match.homeTeam.shortName}</span>
                                <span class="ml-auto font-black text-lg ${h > 0 ? 'text-green-500' : 'text-gray-400'}">${h}</span>
                            </div>
                            <div class="flex items-center gap-3">
                                <img src="${match.awayTeam.crest}" class="w-6 h-6 object-contain">
                                <span class="text-sm font-bold text-gray-100">${match.awayTeam.shortName}</span>
                                <span class="ml-auto font-black text-lg ${a > 0 ? 'text-green-500' : 'text-gray-400'}">${a}</span>
                            </div>
                        </div>
                        <div class="ml-6 ${statusClass} rounded-2xl p-3 min-w-[105px] text-center shadow-lg transition-all">
                            <div class="text-[9px] font-black uppercase leading-none">${stat.mkt}</div>
                            <div class="text-xl font-black mt-1 leading-none">${stat.prob}%</div>
                            <div class="text-[8px] font-bold mt-1.5 uppercase tracking-tighter">${statusText}</div>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }
        fetchData();
    </script>
</body>
</html>